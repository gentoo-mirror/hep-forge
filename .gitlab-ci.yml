image: apnpucky/gentoo

stages:
  - test

variables:
  NAME: "hep-forge"


repoman:
  stage: test
  script:
    - echo "[${NAME}]">>/etc/portage/repos.conf/${NAME}.conf
    - echo "location = /var/db/repos/${NAME}" >>/etc/portage/repos.conf/${NAME}.conf
    - echo "sync-type = git" >>/etc/portage/repos.conf/${NAME}.conf
    - echo "sync-uri = https://gitlab.com/APN-Pucky/gentoo-${NAME}.git" >>/etc/portage/repos.conf/${NAME}.conf
    - emaint -r ${NAME} sync
    - cd /var/db/repos/${NAME}
    - repoman full -d
    - repoman -vx full

pkgcheck:
  stage: test
  script:
    - echo "[${NAME}]">>/etc/portage/repos.conf/${NAME}.conf
    - echo "location = /var/db/repos/${NAME}" >>/etc/portage/repos.conf/${NAME}.conf
    - echo "sync-type = git" >>/etc/portage/repos.conf/${NAME}.conf
    - echo "sync-uri = https://gitlab.com/APN-Pucky/gentoo-${NAME}.git" >>/etc/portage/repos.conf/${NAME}.conf
    - emaint -r ${NAME} sync
    - pkgcheck ci -r hep-forge --exit 
